{% ckan_extends %}
{% set current_lang = request.environ.CKAN_LANG %}

{% block header_account_logged %}
{% set governance_organizations = h.organizations_available(permission='governance') %}
<div class="panel-row">
  <p class="fw-600"><span class="font-01">{{ _("Font size") }}</span></p>
  <div class="options">
    <a class="option btn font-size-btn" data-size="smaller">
      <span style="font-size:14px;">{{ _("A") }}</span>
    </a>
    <a class="option btn font-size-btn" data-size="normal">
      <span style="font-size:16px;">{{ _("A") }}</span>
    </a>
    <a class="option btn font-size-btn" data-size="larger">
      <span style="font-size:20px;">{{ _("A") }}</span>
    </a>
  </div>
</div>
<li>
  <a href="{% url_for h.current_url(), locale='th' %}" class="image lang {% if 'th' == current_lang %}active{% endif %}"
    title="th">
    <img src="{{ h.url_for_static('/base/logo_mea_opendata/th.png') }}" class="user-image" width="22" height="22"
      alt="Gravatar">
  </a>
  <a href="{% url_for h.current_url(), locale='en' %}" class="image lang {% if 'en' == current_lang %}active{% endif %}"
    title="en">
    <img src="{{ h.url_for_static('/base/logo_mea_opendata/en.png') }}" class="user-image" width="22" height="22"
      alt="Gravatar">
  </a>
</li>
{% if h.check_access('steward') %}
<li>
  <a href="/governance/processing_state" title="{{ _('Data Governance') }}">
    <i class="fa fa-cogs" aria-hidden="true"></i>
    <span class="text">{{ _('Data Governance') }}</span>
  </a>
</li>
{% elif governance_organizations | length %}
<li>
  <a href="/governance/processing_state" title="{{ _('Data Governance') }}">
    <i class="fa fa-cogs" aria-hidden="true"></i>
    <span class="text">{{ _('Data Governance') }}</span>
  </a>
</li>
{% endif %}
{{ super() }}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // โหลดการตั้งค่าขนาดฟอนต์จาก localStorage
    const savedFontSize = localStorage.getItem('fontSize');
    if (savedFontSize) {
      adjustFontSize(savedFontSize);
      document.querySelectorAll('.font-size-btn').forEach(button => {
        if (button.getAttribute('data-size') === savedFontSize) {
          button.classList.add('active');
        }
      });
    }
  });

  document.querySelectorAll('.font-size-btn').forEach(button => {
    button.addEventListener('click', function () {
      // ลบคลาส active จากปุ่มทั้งหมด
      document.querySelectorAll('.font-size-btn').forEach(btn => btn.classList.remove('active'));
      // เพิ่มคลาส active ให้กับปุ่มที่ถูกคลิก
      this.classList.add('active');

      // ปรับขนาดฟอนต์และบันทึกการตั้งค่า
      const size = this.getAttribute('data-size');
      adjustFontSize(size);
      localStorage.setItem('fontSize', size);
    });
  });

  function adjustFontSize(size) {
    const elements = document.querySelectorAll('body, h1, h2, h3, h4, h5, h6, p, a');
    elements.forEach(element => {
      if (size === 'smaller') {
        const currentFontSize = parseInt(window.getComputedStyle(element).fontSize);
        element.style.fontSize = (currentFontSize - 2) + 'px';
      } else if (size === 'larger') {
        const currentFontSize = parseInt(window.getComputedStyle(element).fontSize);
        element.style.fontSize = (currentFontSize + 4) + 'px';
      } else {
        // คืนค่าเริ่มต้นของฟอนต์
        element.style.fontSize = '';
      }
    });
  }
</script>
{% endblock %}

{% block header_account_notlogged %}
<div class="panel-row">
  <p class="fw-600"><span class="font-01">{{ _("Font size") }}</span></p>
  <div class="options">
    <a class="option btn font-size-btn" data-size="smaller">
      <span style="font-size:14px;">{{ _("A") }}</span>
    </a>
    <a class="option btn font-size-btn" data-size="normal">
      <span style="font-size:16px;">{{ _("A") }}</span>
    </a>
    <a class="option btn font-size-btn" data-size="larger">
      <span style="font-size:20px;">{{ _("A") }}</span>
    </a>
  </div>
</div>
<li>
  <a href="{% url_for h.current_url(), locale='th' %}" class="image lang {% if 'th' == current_lang %}active{% endif %}"
    title="th">
    <img src="{{ h.url_for_static('/base/logo_mea_opendata/th.png') }}" class="user-image" width="22" height="22"
      alt="Gravatar">
  </a>
  <a href="{% url_for h.current_url(), locale='en' %}" class="image lang {% if 'en' == current_lang %}active{% endif %}"
    title="en">
    <img src="{{ h.url_for_static('/base/logo_mea_opendata/en.png') }}" class="user-image" width="22" height="22"
      alt="Gravatar">
  </a>
</li>
{{ super() }}


<script>
  document.addEventListener('DOMContentLoaded', function () {
    // โหลดการตั้งค่าขนาดฟอนต์จาก localStorage
    const savedFontSize = localStorage.getItem('fontSize');
    if (savedFontSize) {
      adjustFontSize(savedFontSize);
      document.querySelectorAll('.font-size-btn').forEach(button => {
        if (button.getAttribute('data-size') === savedFontSize) {
          button.classList.add('active');
        }
      });
    }
  });

  document.querySelectorAll('.font-size-btn').forEach(button => {
    button.addEventListener('click', function () {
      // ลบคลาส active จากปุ่มทั้งหมด
      document.querySelectorAll('.font-size-btn').forEach(btn => btn.classList.remove('active'));
      // เพิ่มคลาส active ให้กับปุ่มที่ถูกคลิก
      this.classList.add('active');

      // ปรับขนาดฟอนต์และบันทึกการตั้งค่า
      const size = this.getAttribute('data-size');
      adjustFontSize(size);
      localStorage.setItem('fontSize', size);
    });
  });

  function adjustFontSize(size) {
    const elements = document.querySelectorAll('body, h1, h2, h3, h4, h5, h6, p, a');
    elements.forEach(element => {
      if (size === 'smaller') {
        const currentFontSize = parseInt(window.getComputedStyle(element).fontSize);
        element.style.fontSize = (currentFontSize - 2) + 'px';
      } else if (size === 'larger') {
        const currentFontSize = parseInt(window.getComputedStyle(element).fontSize);
        element.style.fontSize = (currentFontSize + 4) + 'px';
      } else {
        // คืนค่าเริ่มต้นของฟอนต์
        element.style.fontSize = '';
      }
    });
  }
</script>
{% endblock %}